<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Ubuntu Router" /><meta property="og:locale" content="en" /><meta name="description" content="Ubuntu Router" /><meta property="og:description" content="Ubuntu Router" /><link rel="canonical" href="https://github.com/jonnypeace/jonnypeace.github.io.git/posts/Ubuntu-Router/" /><meta property="og:url" content="https://github.com/jonnypeace/jonnypeace.github.io.git/posts/Ubuntu-Router/" /><meta property="og:site_name" content="HomeLab Hub" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-06T13:30:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ubuntu Router" /><meta name="twitter:site" content="@JonnyLinuxPeace" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-04-26T06:24:21+01:00","datePublished":"2022-08-06T13:30:00+01:00","description":"Ubuntu Router","headline":"Ubuntu Router","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/jonnypeace/jonnypeace.github.io.git/posts/Ubuntu-Router/"},"url":"https://github.com/jonnypeace/jonnypeace.github.io.git/posts/Ubuntu-Router/"}</script><title>Ubuntu Router | HomeLab Hub</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="HomeLab Hub"><meta name="application-name" content="HomeLab Hub"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/motherboard.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">HomeLab Hub</a></div><div class="site-subtitle font-italic">Your one-stop for bash, python & Linux magic</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/jonnypeace" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/JonnyLinuxPeace" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jonnypeace','outlook.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Ubuntu Router</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Ubuntu Router</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1659789000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 6, 2022 </em> </span> <span> Updated <em class="" data-ts="1682486661" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Apr 26, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/JonnyLinuxPeace">jonny peace</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2291 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h1 id="ubuntu-router">Ubuntu Router</h1><p><em>Update 26-04-2023</em></p><p>Around 3 months ago I upgraded to a N5105 5 port 2.5gb router using the exact same set up, after upgrading my LAN to full 1gbps fibre. I never stumbled across any issues with the raspberry pi setup, but will issue a blog update with new setup :)</p><p>I’ve been using my raspberry pi4 with 2 extra USB3 to LAN Gb adapters for a few months and it has felt quite stable for a routing device. My ISP speed is 65Mbps Download and 18Mbps Upload, and with the lack of AES, i’ve not attempted to do VPN traffic, but i have tested it with openelec, and it was able to push through my ISP download speed, but it might struggle if you have a better internet connection.</p><h2 id="so-the-ubuntu-router"><span class="mr-2">So, the Ubuntu router</span><a href="#so-the-ubuntu-router" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I’ve decided to stay with the UFW firewall, but i have thought about trying firewalld.. maybe for another day. With the type of routing I required, I decided to make a bridged network, and hence the two extra USB ethernet ports.</p><p>Packages installed:</p><ul><li>isc-dhcp-server<li>cockpit</ul><p>So lets begin</p><h2 id="netplan"><span class="mr-2">Netplan</span><a href="#netplan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Check which interfaces are available…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ip a
</pre></table></code></div></div><p>The three interfaces i’m interested are the built in ethernet and 2 x USB ethernet.</p><blockquote><p>eth0 - built-in ethernet</p><p>enxa0cec8c0b0e2 - usb ethernet</p><p>enx000ec6dab3a7 -usb ethernet</p></blockquote><p>eth0 will be my WAN</p><p>enx000ec6dab3a7 &amp; enxa0cec8c0b0e2 will be my bridge network br0.10</p><p>Firstly, lets create the bridge network using netplan…</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="na">network</span><span class="pi">:</span>
    <span class="na">ethernets</span><span class="pi">:</span>
      <span class="na">eth0</span><span class="pi">:</span>
        <span class="na">addresses</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">192.168.1.10/24</span><span class="pi">]</span>
        <span class="na">routes</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span> <span class="s">default</span>
            <span class="na">via</span><span class="pi">:</span> <span class="s">192.168.1.1</span>
        <span class="na">nameservers</span><span class="pi">:</span> 
          <span class="na">addresses</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">9.9.9.9</span><span class="pi">,</span> <span class="nv">149.112.112.112</span><span class="pi">]</span>
      <span class="na">enx000ec6dab3a7</span><span class="pi">:</span> <span class="pi">{}</span>
      <span class="na">enxa0cec8c0b0e2</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">bridges</span><span class="pi">:</span>
      <span class="na">br0.10</span><span class="pi">:</span>
        <span class="na">addresses</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">10.10.10.1/24</span><span class="pi">]</span>
        <span class="na">nameservers</span><span class="pi">:</span>
          <span class="na">addresses</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">9.9.9.9</span><span class="pi">,</span> <span class="nv">149.112.112.112</span><span class="pi">]</span>
        <span class="na">interfaces</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">enxa0cec8c0b0e2</span>
          <span class="pi">-</span> <span class="s">enx000ec6dab3a7</span>
    <span class="na">version</span><span class="pi">:</span> <span class="m">2</span>
    <span class="na">renderer</span><span class="pi">:</span> <span class="s">NetworkManager</span>
</pre></table></code></div></div><p><strong><em>eth0</em></strong></p><p>Addresses is the ip address for the ubuntu router, which is connected to my ISP router (for the WAN), and the ISP router supplies this LAN ip.</p><p>For eth0 default routes via… this is my router ip address 192.168.1.1.</p><p>For eth0 nameservers, i’ve just included quad 9’s IP address, but update with your own preference.</p><p>enx000ec6dab3a7: {} - This basically identifies the interface for later use</p><p>enxa0cec8c0b0e2: {} - This basically identifies the interface for later use</p><p><strong><em>Bridges</em></strong></p><p>br0.10 is the interface i’ll be using for my LAN, using the ip address</p><p>10.10.10.10.1 will be the ubuntu lan ip which devices connect to.</p><p>Nameservers is the same idea as the WAN.</p><p>Includes both interfaces for the bridge</p><p>renderer - i added this in for NetworkManager, so i could use cockpit with this setup.</p><h2 id="isc-dhcp-server"><span class="mr-2">isc-dhcp-server</span><a href="#isc-dhcp-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>isc-dhcp-server
</pre></table></code></div></div><p>Now lets edit this file /etc/default/isc-dhcp-server</p><p>at the bottom include these two lines</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">INTERFACESv4</span><span class="o">=</span><span class="s2">"br0.10"</span>
<span class="nv">INTERFACESv6</span><span class="o">=</span><span class="s2">""</span>
</pre></table></code></div></div><h2 id="etcdhcpdhcpdconf"><span class="mr-2">/etc/dhcp/dhcpd.conf</span><a href="#etcdhcpdhcpdconf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now lets edit this file /etc/dhcp/dhcpd.conf</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>default-lease-time 43200<span class="p">;</span>
max-lease-time 86400<span class="p">;</span>
authoritative<span class="p">;</span>
subnet 10.10.10.0 netmask 255.255.255.0 <span class="o">{</span>
    option domain-name <span class="s2">"home.lan"</span><span class="p">;</span>
    option routers 10.10.10.1<span class="p">;</span>
    option subnet-mask 255.255.255.0<span class="p">;</span>
    option broadcast-address 10.10.10.255<span class="p">;</span>
    range 10.10.10.100 10.10.10.200<span class="p">;</span>
    option domain-name-servers 9.9.9.9<span class="p">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Lease times are something a DHCP server will renew, and these are the times i’ve decided on.</p><p>This sets up a 10.10.10.1/24 LAN network for your devices to connect to with DHCP.</p><p>The range of 10.10.10.100-10.10.10.200 is for the dhcp server. This reserves the 10.10.10.2-10.10.10.99 &amp; 10.10.10.201+ range for static IPs</p><p>Looking at ubuntu’s documentation on this, it looks like you can assign static IP’s using the MAC addresses in this config file.</p><p><a href="https://help.ubuntu.com/community/isc-dhcp-server">Ubuntu - isc-dhcp-server link</a></p><p>All my static IP’s are done on the host, so it’s not something i’ve centralised like this.</p><h2 id="dhcp-leases"><span class="mr-2">dhcp leases</span><a href="#dhcp-leases" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You can view your DHCP leases here…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>less /var/lib/dhcp/dhcpd.leases
</pre></table></code></div></div><h2 id="ufw"><span class="mr-2">UFW</span><a href="#ufw" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ok, this will depend a little on your services, but this is where i’ve went with it.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ufw limit from 10.10.10.0/24 to any port 22 proto tcp
<span class="nb">sudo </span>ufw allow from 10.10.10.0/24 to any port 67 proto udp
<span class="nb">sudo </span>ufw allow from 10.10.10.0/24 to any port 68 proto udp
<span class="nb">sudo </span>ufw allow from 10.10.10.0/24 to any port 53 proto tcp
<span class="nb">sudo </span>ufw allow from 10.10.10.0/24 to any port 53 proto udp
<span class="nb">sudo </span>ufw allow from 10.10.10.0/24 to any port 9090 proto tcp

<span class="nb">sudo </span>ufw route allow <span class="k">in </span>on br0.10 out on eth0

</pre></table></code></div></div><p>I’ve allowed ssh (with a rate limit) access on the LAN, DHCP (67,68), DNS(53), and cockpit(9090).</p><p>I’m allowing traffic to be forwarded from the bridge, to the WAN.</p><p>We also need to edit /etc/ufw/sysctl.conf and uncomment this..</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>net.ipv4.ip_forward<span class="o">=</span>1
</pre></table></code></div></div><p>Lastly for the firewall, we need a NAT masquerade.</p><p>Lets edit the /etc/ufw/before.rules and include these lines before the filter rules.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c"># nat Table rules</span>
<span class="k">*</span>nat
:POSTROUTING ACCEPT <span class="o">[</span>0:0]

<span class="c"># Forward traffic from br0.10 through eth0.</span>
<span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 10.10.10.0/24 <span class="nt">-o</span> eth0 <span class="nt">-j</span> MASQUERADE

<span class="c"># don't delete the 'COMMIT' line or these nat table rules won't be processed</span>
COMMIT
</pre></table></code></div></div><p>Directly under the MASQUERADE rule, the rule for that table must have COMMIT. This is the case for each table in these rules.</p><p>We should be able to apply our netplan now..</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>netplan <span class="nt">--debug</span> generate
<span class="nb">sudo </span>netplan generate
<span class="nb">sudo </span>netplan apply
</pre></table></code></div></div><p>We should be able to apply our firewall rules now as well</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ufw disable <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>ufw <span class="nb">enable</span>
</pre></table></code></div></div><p>ufw reload might work, but the documentation from Ubuntu states the above. command.</p><p>If you want a birds eye view of your router, cockpit is great, and if you’ve configured your firewall like mine, you should be able to connect to it via port 9090</p><p>So i would install cockpit…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>cockpit
</pre></table></code></div></div><p>For the UFW firewall, check out Ubuntu’s website, they might cover some commands you’ll find useful.</p><p><a href="https://ubuntu.com/server/docs/security-firewall">Ubuntu UFW Docs</a></p><h2 id="vlans"><span class="mr-2">VLANs</span><a href="#vlans" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>Updated: 07/11/2022</em></p><p>Ok, I wanted to write about this earlier in the year, but my managed switch died on me, and I’ve only just got round to replacing it.</p><p>FYI, I am using a TP-Link smart managed switch here, nothing too fancy but this is the model number TL-SG1016DE. All I need is a little network segregation and this fits the bill for a reasonable price. No high speeds in this house, but gigabit LAN has been good to me over the years.</p><p>Due to me self hosting some services, I wanted to keep the self hosted network separate from my safer home network, and hence the vlan. I am going to continue with the bridge netplan discussed earlier, and include one VLAN in this configuration. This vlan network consists of an LXD cluster and some other goodies, but for container creation, i need DHCP as i’m using macVLAN with the LXD cluster, so in this section i’ll have to include something for the VLAN DHCP server, so lets begin…</p><h2 id="vlan---netplan-yaml"><span class="mr-2">VLAN - Netplan YAML</span><a href="#vlan---netplan-yaml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>network:
    ethernets:
      eth0:
        addresses: <span class="o">[</span>192.168.1.10/24]
        routes:
          - to: default
            via: 192.168.1.1
        nameservers: 
          addresses: <span class="o">[</span>9.9.9.9, 149.112.112.112]
      enx000ec6dab3a7: <span class="o">{}</span>
      enxa0cec8c0b0e2: <span class="o">{}</span>
    bridges:
      br0.10:
        addresses:
          - 10.10.10.1/24]
        nameservers:
          addresses: <span class="o">[</span>9.9.9.9, 149.112.112.112]
        interfaces:
          - enxa0cec8c0b0e2
          - enx000ec6dab3a7
    vlans:
      vlan2:
        <span class="nb">id</span>: 2
        <span class="nb">link</span>: br0.10
        addresses: <span class="o">[</span>10.10.20.1/24]
    version: 2
    renderer: NetworkManager
</pre></table></code></div></div><h2 id="etcufwbeforerules"><span class="mr-2">/etc/ufw/before.rules</span><a href="#etcufwbeforerules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This file now has this inclusion of the VLAN (10.10.20.0/24)masquerade..</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c"># nat Table rules</span>
<span class="k">*</span>nat
:POSTROUTING ACCEPT <span class="o">[</span>0:0]

<span class="c"># Forward traffic from vlan2 &amp; br0.10 through a NAT on eth0.</span>
<span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 10.10.10.0/24 <span class="nt">-o</span> eth0 <span class="nt">-j</span> MASQUERADE
<span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 10.10.20.0/24 <span class="nt">-o</span> eth0 <span class="nt">-j</span> MASQUERADE

<span class="c"># don't delete the 'COMMIT' line or these nat table rules won't be processed</span>
COMMIT
</pre></table></code></div></div><p>Ok this bit will be dependant on the whether you want one way traffic or any sort of communication between your VLAN and safer home network, and i do, so i’ll include them and explain.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c"># When you find the rules below....</span>

<span class="c"># Don't delete these required lines, otherwise there will be errors</span>
<span class="k">*</span>filter
:ufw-before-input - <span class="o">[</span>0:0]
:ufw-before-output - <span class="o">[</span>0:0]
:ufw-before-forward - <span class="o">[</span>0:0]
:ufw-not-local - <span class="o">[</span>0:0]
<span class="c"># End required lines</span>

<span class="c"># ENTER FORWARD RULES NOW...</span>

<span class="c">#### MY forward</span>
<span class="c"># vlan2 to WAN - this could be included with the standard UFW command, but since i'm here (a few of these rules could probably be applied on the commandline, but this was easier to test the rules)...</span>
<span class="nt">-A</span> ufw-before-forward <span class="nt">-i</span> vlan2 <span class="nt">-o</span> eth0 <span class="nt">-j</span> ACCEPT

<span class="c">## Firewall rules between vlan2 and specific device.</span>
<span class="c"># NFS share for jellyfin - i've had to set it up this way, so the jellyfin container can mount the NFS share. </span>
<span class="c"># Funnily enough, I am using firewalld on this server, so i added the jellyfin to the public zone where only NFS is allowed. </span>
<span class="c"># Also, with NFS, i have provided these mount paths with read only access from /etc/exports, just to harden security. Jellyfin doesn't need write access to them.</span>
<span class="nt">-A</span> ufw-before-forward <span class="nt">-s</span> 10.10.10.40/32 <span class="nt">-o</span> vlan2 <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> ufw-before-forward <span class="nt">-i</span> vlan2 <span class="nt">-d</span> 10.10.10.40/32 <span class="nt">-j</span> ACCEPT

<span class="c"># Leave this section at the bottom of the MY forward rules. This uses conntrack to prevent vlan2 from initiating new connections with my phone or laptop that i've let through the guard.</span>
<span class="nt">-A</span> ufw-before-forward <span class="nt">-o</span> vlan2 <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> ufw-before-forward <span class="nt">-i</span> vlan2 <span class="nt">-m</span> state <span class="o">!</span> <span class="nt">--state</span> NEW <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> ufw-before-forward <span class="nt">-i</span> vlan2 <span class="nt">-m</span> state <span class="nt">--state</span> NEW <span class="nt">-j</span> REJECT

</pre></table></code></div></div><p>Once those rules are added, remember to…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ufw reload
</pre></table></code></div></div><h3 id="ufw-rules"><span class="mr-2">UFW rules</span><a href="#ufw-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ok, now some standard DHCP and DNS access rules. It’s worth pointing out. I’m using DNS 9.9.9.9 etc in my netplan example, but the reality is i’m using pihole, or i could use bind.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ufw allow from 10.10.20.0/24 to any port 67 proto udp
<span class="nb">sudo </span>ufw allow from 10.10.20.0/24 to any port 68 proto udp
<span class="nb">sudo </span>ufw allow from 10.10.20.0/24 to any port 53 proto tcp
<span class="nb">sudo </span>ufw allow from 10.10.20.0/24 to any port 53 proto udp
</pre></table></code></div></div><h2 id="vlan---dhcp-server"><span class="mr-2">VLAN - DHCP Server</span><a href="#vlan---dhcp-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ok, time to add the vlan2 to the DHCP server.</p><h3 id="etcdhcpdhcpdconf-1"><span class="mr-2">/etc/dhcp/dhcpd.conf</span><a href="#etcdhcpdhcpdconf-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>default-lease-time 43200<span class="p">;</span>
max-lease-time 86400<span class="p">;</span>
authoritative<span class="p">;</span>
<span class="c">## vlan2</span>
subnet 10.10.20.0 netmask 255.255.255.0 <span class="o">{</span>
    option domain-name <span class="s2">"vlan2.lan"</span><span class="p">;</span>
    option routers 10.10.20.1<span class="p">;</span>
    option subnet-mask 255.255.255.0<span class="p">;</span>
    option broadcast-address 10.10.20.255<span class="p">;</span>
    range 10.10.20.50 10.10.20.100<span class="p">;</span>
    option domain-name-servers 9.9.9.9<span class="p">;</span>
<span class="o">}</span>
<span class="c">## home.lan</span>
subnet 10.10.10.0 netmask 255.255.255.0 <span class="o">{</span>
    option domain-name <span class="s2">"home.lan"</span><span class="p">;</span>
    option routers 10.10.10.1<span class="p">;</span>
    option subnet-mask 255.255.255.0<span class="p">;</span>
    option broadcast-address 10.10.10.255<span class="p">;</span>
    range 10.10.10.100 10.10.10.200<span class="p">;</span>
    option domain-name-servers 9.9.9.9<span class="p">;</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="etcdefaultisc-dhcp-server"><span class="mr-2">/etc/default/isc-dhcp-server</span><a href="#etcdefaultisc-dhcp-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">INTERFACESv4</span><span class="o">=</span><span class="s2">"br0.10 vlan2"</span>
<span class="nv">INTERFACESv6</span><span class="o">=</span><span class="s2">""</span>
</pre></table></code></div></div><p>If there is anything that could be improved with this setup, please get in touch. I never included stateful rules with the ufw forward, simply because ufw-before-forward rules have this included by default…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># quickly process packets for which we already have a connection</span>
<span class="nt">-A</span> ufw-before-input <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> RELATED,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> ufw-before-output <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> RELATED,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> ufw-before-forward <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> RELATED,ESTABLISHED <span class="nt">-j</span> ACCEPT
</pre></table></code></div></div><p>And if you have set this up like I have, and scan iptables…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>iptables <span class="nt">-vL</span> | less
</pre></table></code></div></div><p>And look for…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Chain ufw-before-forward <span class="o">(</span>1 references<span class="o">)</span>
 pkts bytes target     prot opt <span class="k">in     </span>out     <span class="nb">source               </span>destination         
1425K   78M ACCEPT     all  <span class="nt">--</span>  vlan2  eth0    anywhere             anywhere            
    0     0 ACCEPT     all  <span class="nt">--</span>  any    vlan2   10.10.10.185        anywhere            
  181 12442 ACCEPT     all  <span class="nt">--</span>  any    vlan2   10.10.10.175        anywhere            
20486 1846K ACCEPT     all  <span class="nt">--</span>  any    vlan2   nfs.home             anywhere            
27170 2328K ACCEPT     all  <span class="nt">--</span>  vlan2  any     anywhere             nfs.home            
3276K 4648M ACCEPT     all  <span class="nt">--</span>  any    vlan2   anywhere             anywhere            
 183K   81M ACCEPT     all  <span class="nt">--</span>  vlan2  any     anywhere             anywhere             <span class="o">!</span> state NEW
    5   372 REJECT     all  <span class="nt">--</span>  vlan2  any     anywhere             anywhere             state NEW reject-with icmp-port-unreachable
  43M   53G ACCEPT     all  <span class="nt">--</span>  any    any     anywhere             anywhere             ctstate RELATED,ESTABLISHED
    0     0 ACCEPT     icmp <span class="nt">--</span>  any    any     anywhere             anywhere             icmp destination-unreachable
    0     0 ACCEPT     icmp <span class="nt">--</span>  any    any     anywhere             anywhere             icmp time-exceeded
    0     0 ACCEPT     icmp <span class="nt">--</span>  any    any     anywhere             anywhere             icmp parameter-problem
 4836  342K ACCEPT     icmp <span class="nt">--</span>  any    any     anywhere             anywhere             icmp echo-request
59103   10M ufw-user-forward  all  <span class="nt">--</span>  any    any     anywhere             anywhere            

</pre></table></code></div></div><p>You can see the ctstate RELATED,ESTABLISHED processes the bulk of the packets (53G), and with my understanding… this accomplishes a stateful rule for the before-forward traffic. There’s every chance i’ve missed or included something unnecessary, and I would be forever grateful if this was highlighted to me. Fingers crossed you have a new ubuntu router, with VLAN traffic.</p><h2 id="the-switch---tp-link-tl-sg1016de"><span class="mr-2">The Switch - TP Link TL-SG1016DE</span><a href="#the-switch---tp-link-tl-sg1016de" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Examples for making this simple smart managed switch to work with vlans. Just remember to set the vlan ID to the same ID as on your ubuntu router.</p><p><img data-src="https://i.ibb.co/09Rcsyg/Screenshot-from-2022-11-07-21-37-05.png" alt="Switch vlan settings" data-proofer-ignore> <em>bridge</em></p><p><img data-src="https://i.ibb.co/DG60R1j/Screenshot-from-2022-11-07-21-36-56.png" alt="Switch vlan settings" data-proofer-ignore> <em>vlan2</em></p><p>In this example, i’ve removed ports 4, 6 and 8 on the vlan config to non members of vlan ID 1 (vlan id 1 is untagged so will work on bridge). I then added ports 4, 6 and 8 to the vlan id 2 untagged. Port 16 in this example is tagged, which is the port connecting to the ubuntu router. It will tag all untagged ports and send to the ubuntu router.</p><p><img data-src="https://i.ibb.co/xzH3M2S/Screenshot-from-2022-11-07-21-37-27.png" alt="Switch vlan settings" data-proofer-ignore> <em>default vlan-id</em></p><p>This section is so simple yet i overlooked it when testing. Everything defaults to vlan id 1 on initial setup. So when running vlans, you will need to set the default here. In this example I have set ports 4, 6 and 8 to default to vlan id 2. This is quite different from my old linksys/cisco switch, but not too different.</p><p>Fingers crossed you have a functioning ubuntu router, and with vlans if you choose.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/homelab/'>homelab</a>, <a href='/categories/project/'>project</a>, <a href='/categories/routing/'>routing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/servers/" class="post-tag no-text-decoration" >servers</a> <a href="/tags/homelab/" class="post-tag no-text-decoration" >homelab</a> <a href="/tags/bash/" class="post-tag no-text-decoration" >bash</a> <a href="/tags/routing/" class="post-tag no-text-decoration" >routing</a> <a href="/tags/firewall/" class="post-tag no-text-decoration" >firewall</a> <a href="/tags/ubuntu/" class="post-tag no-text-decoration" >ubuntu</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ubuntu+Router+-+HomeLab+Hub&url=https%3A%2F%2Fgithub.com%2Fjonnypeace%2Fjonnypeace.github.io.git%2Fposts%2FUbuntu-Router%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ubuntu+Router+-+HomeLab+Hub&u=https%3A%2F%2Fgithub.com%2Fjonnypeace%2Fjonnypeace.github.io.git%2Fposts%2FUbuntu-Router%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fgithub.com%2Fjonnypeace%2Fjonnypeace.github.io.git%2Fposts%2FUbuntu-Router%2F&text=Ubuntu+Router+-+HomeLab+Hub" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/docker-lxd-keepalive/">High Availability with KeepaliveD-Docker-LXD</a><li><a href="/posts/arch-printer/">Setting up an HP Printer on Arch Linux</a><li><a href="/posts/basic-zfs/">ZFS Mirror, Snapshots, Recovery</a><li><a href="/posts/neovim-customization/">Setting up a Custom Neovim config on Arch Linux</a><li><a href="/posts/inc-tar/">Simple Incremental Backup Script</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/lxd/">lxd</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/arch-linux/">Arch Linux</a> <a class="post-tag" href="/tags/backup/">backup</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/servers/">servers</a> <a class="post-tag" href="/tags/zfs/">zfs</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Welcome/"><div class="card-body"> <em class="small" data-ts="1654873200" data-df="ll" > Jun 10, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Welcome to my Homelab</h3><div class="text-muted small"><p> Welcome Hello and welcome to my homelab project site Website project in progress Here I will be sharing some of my homelab projects and some scripts using mostly…. Ansible Bash Python ...</p></div></div></a></div><div class="card"> <a href="/posts/wol/"><div class="card-body"> <em class="small" data-ts="1696179600" data-df="ll" > Oct 1, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ubuntu 22.04 WakeOnLan</h3><div class="text-muted small"><p> Wake On Lan… OS: Ubuntu 22.04 server Wake on lan has been around for a while, and while server grade hardware will have some sort of server management system, or of course the new pikvm which I h...</p></div></div></a></div><div class="card"> <a href="/posts/software-raid-boot/"><div class="card-body"> <em class="small" data-ts="1697299200" data-df="ll" > Oct 14, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Software Raid Boot Drive Ubuntu</h3><div class="text-muted small"><p> Ubuntu Software Raid on Boot Device OS: Ubuntu 22.04 server At Installation… Select “Custom storage layout” If the disks have existing partitions, click on each disk under AVAILABLE DEVICES...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/inc-tar/" class="btn btn-outline-primary" prompt="Older"><p>Simple Incremental Backup Script</p></a> <a href="/posts/ans-nc-lxd/" class="btn btn-outline-primary" prompt="Newer"><p>Ansible / Bash - Nextcloud Deployment - LXD</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/JonnyLinuxPeace">jonny peace</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/lxd/">lxd</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/arch-linux/">Arch Linux</a> <a class="post-tag" href="/tags/backup/">backup</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/servers/">servers</a> <a class="post-tag" href="/tags/zfs/">zfs</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3"></p><button type="button" class="btn btn-primary" aria-label="Update"> </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
